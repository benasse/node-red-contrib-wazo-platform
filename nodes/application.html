<script type="text/javascript">
  RED.nodes.registerType('wazoApplication', {
    category: 'config',
    defaults: {
      name: {}
    },
    credentials: {
      apikey: {type: "text"},
      apisecret: {type: "text"},
      app_uuid: {type: "text"},
    },
    label: function() {
      return this.name;
    }
  });
</script>

<script type="text/x-red" data-template-name="wazoApplication">
  <div class="form-row">
    <label for="node-config-input-name">Name</label>
    <input type="text" id="node-config-input-name" placeholder="Name">
  </div>

  <div class="form-row">
    <label for="node-config-input-server">Server</label>
    <input type="text" id="node-config-input-server" placeholder="Wazo server">
  </div>

  <div class="form-row">
    <label for="node-config-input-apikey">API Key</label>
    <input type="text" id="node-config-input-apikey" placeholder="Wazo API Key">
  </div>

  <div class="form-row">
    <label for="node-config-input-apisecret">API Secret</label>
    <input type="text" id="node-config-input-apisecret" placeholder="Wazo API Secret">
  </div>

  <div class="form-row">
    <button id="button" onclick="newWazoApplication()">Create New Application</button><br>
  </div>

  <div class="form-row">
    <label for="node-config-input-app_uuid"></i>Application UUID</label>
    <input type="text" id="node-config-input-app_uuid" placeholder="Application UUID" disabled>
  </div>
</script>

<script type="text/x-red" data-help-name="nexmovoiceapp">
   <p>Creates a new Nexmo Voice Application </p>
   <h3>Details</h3>
   <p>Enter your details in the boxes above and click, Create Application, node-red will then create a new nexmo application on your account and fill in the Dpp ID and Private Key fields for you to save.</p>
   <p> This auth module can be used by any Nexmo Voice nodes that require auth.</p>
</script>


<script>
  function newWazoApplication() {
    var url = 'nexmo-auth/new-voice-app';
    var params = {
      api_key:  document.getElementById("node-config-input-apikey").value,
      api_secret: document.getElementById("node-config-input-apisecret").value,
      name : document.getElementById("node-config-input-name").value,
    }
    $.post(url, params, function(res) {
      document.getElementById("node-config-input-appid").value = res.id;
      document.getElementById("node-config-input-privatekey").value = res.keys.private_key;
    }, 'json'
    );
  }
</script>
